(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[159],{83740:function(Q,B,e){"use strict";e.r(B),e.d(B,{default:function(){return F}});var z=e(86582),V=e(57663),A=e(71577),W=e(34792),D=e(48086),s=e(39428),S=e(3182),E=e(69610),P=e(54941),K=e(3372),O=e(81306),k=e(80017),T=e(62260),H=e(67265),J=e(25590),M=e(67294),L=e(30381),Y=e.n(L),l=e(85893),$=[{title:"\u7248\u672C\u53F7",dataIndex:"name",search:!1},{title:"\u5927\u5C0F",dataIndex:"size",search:!1,render:function(i){return Math.round(i/1024/1024*100)/100+"M"}},{title:"\u4E0B\u8F7D\u5730\u5740",dataIndex:"url",search:!1,render:function(i){return(0,l.jsx)("a",{href:i,target:"_blank",children:i})}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",width:180,search:!1,render:function(i){return Y()(i*1e3).format("YYYY-MM-DD HH:mm:ss")}}],N=e(84391),G=e(65754),U=e.n(G),F=function(x){(0,O.Z)(h,x);var i=(0,k.Z)(h);function h(I){var n;return(0,E.Z)(this,h),n=i.call(this,I),n.actionRef=void 0,n.state={loading:!1},n.getData=function(){var m=(0,S.Z)((0,s.Z)().mark(function c(o){var f;return(0,s.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,T.rU)(o);case 2:return f=t.sent,t.abrupt("return",f);case 4:case"end":return t.stop()}},c)}));return function(c){return m.apply(this,arguments)}}(),n.upload=function(){var m=(0,S.Z)((0,s.Z)().mark(function c(o,f){var C,t,r,a;return(0,s.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n.setState({loading:!0}),C=new(U())({getAuthorization:function(g,v){var p="/api/getCosSign",y=new XMLHttpRequest;y.open("GET",p,!0),y.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token")),y.onload=function(d){try{var Z=JSON.parse(d.target.responseText),R=Z.data.credentials;!Z||!R?console.error(`credentials invalid:
`+JSON.stringify(Z,null,2)):v({TmpSecretId:R.tmpSecretId,TmpSecretKey:R.tmpSecretKey,SecurityToken:R.sessionToken,StartTime:Z.data.startTime,ExpiredTime:Z.data.expiredTime})}catch(X){console.error(X)}},y.send()}}),u.next=4,(0,T.DJ)({type:1});case 4:if(t=u.sent,r=(0,K.Z)(n),a=o.name.split("\\"),!(!a||a.length===0||!/[a-z]+_v\d+\.\d+\.\d+\.apk/.test(a[a.length-1])||a[a.length-1].indexOf(t.data.logo)!==0)){u.next=11;break}return r.setState({loading:!1}),r.actionRef.current.reload(),u.abrupt("return",D.ZP.error("\u6587\u4EF6\u540D\u4E0D\u7B26\u5408\u89C4\u8303"));case 11:C.putObject({Bucket:t.data.bucket,Region:t.data.region,Key:"apk/"+a[a.length-1],Body:o,onProgress:function(g){var v=JSON.stringify(g);v.percent==1&&r.setState({loading:!0})}},function(){var j=(0,S.Z)((0,s.Z)().mark(function g(v,p){return(0,s.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(r.setState({loading:!1}),console.log(v||p),p.statusCode!=200){d.next=7;break}return d.next=5,(0,T.Ku)({value:p.Location});case 5:r.actionRef.current.reload(),D.ZP.success("\u6210\u529F");case 7:case"end":return d.stop()}},g)}));return function(g,v){return j.apply(this,arguments)}}());case 12:case"end":return u.stop()}},c)}));return function(c,o){return m.apply(this,arguments)}}(),n.actionRef=M.createRef(),n}return(0,P.Z)(h,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var n=this,m=this;return(0,l.jsx)(H.ZP,{children:(0,l.jsx)(J.Z,{actionRef:this.actionRef,rowKey:"id",search:!1,toolBarRender:function(){return[(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{onChange:function(){var o=(0,S.Z)((0,s.Z)().mark(function f(C){return(0,s.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,m.upload(document.getElementById("file").files[0],document.getElementById("file"));case 2:case"end":return r.stop()}},f)}));return function(f){return o.apply(this,arguments)}}(),id:"file",hidden:!0,type:"file"},"file"),(0,l.jsxs)(A.Z,{loading:n.state.loading,type:"primary",onClick:function(){document.getElementById("file").click()},children:[(0,l.jsx)(N.Z,{}),"\u4E0A\u4F20Apk"]},"btn")]},"uni")]},request:this.getData,columns:(0,z.Z)($)})})}}]),h}(M.Component)}}]);
